# ğŸ“§ Solicitud Manual de Correo Institucional Docente

## Nueva Funcionalidad v1.1

Esta versiÃ³n incluye un **formulario manual** que permite a los tÃ©cnicos L1 crear solicitudes de correo institucional para docentes de manera controlada, editando toda la informaciÃ³n antes de enviar el email de aprobaciÃ³n.

---

## ğŸ¯ CaracterÃ­sticas

### Formulario Completo con:

âœ… **Datos del Docente**
- Nombre completo
- NÃºmero de legajo
- Email institucional deseado

âœ… **Datos del Departamento/Ãrea**
- Nombre del departamento o Ã¡rea responsable

âœ… **Responsable Aprobador**
- Email del director/responsable que debe aprobar
- Se puede modificar por solicitud

âœ… **Observaciones** (opcional)
- Campo libre para informaciÃ³n adicional

---

## ğŸ“§ Email Profesional Mejorado

El email enviado ahora incluye:

### âœ¨ DiseÃ±o HTML Moderno
- Gradientes y colores profesionales
- Responsive (se adapta a mÃ³viles)
- Botones grandes y visibles
- Formato tabular claro

### ğŸ“‹ InformaciÃ³n Completa
```
â€¢ Nombre del docente
â€¢ NÃºmero de legajo
â€¢ Email solicitado
â€¢ Departamento/Ãrea
â€¢ Enlace directo al ticket
```

### ğŸ¨ Vista Previa del Email

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                              â•‘
â•‘   ğŸ“§ Solicitud de Correo Institucional                      â•‘
â•‘      AprobaciÃ³n Requerida - Ticket #123                     â•‘
â•‘                                                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                              â•‘
â•‘  Estimado/a Responsable de Departamento de InformÃ¡tica,     â•‘
â•‘                                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ ğŸ‘¤ Datos del Docente                                   â”‚ â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â•‘
â•‘  â”‚ Nombre completo:    Juan PÃ©rez GarcÃ­a                  â”‚ â•‘
â•‘  â”‚ Nro. de Legajo:     12345                              â”‚ â•‘
â•‘  â”‚ Email solicitado:   juan.perez@institucion.edu.ar      â”‚ â•‘
â•‘  â”‚ Departamento/Ãrea:  Departamento de InformÃ¡tica        â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                                              â•‘
â•‘  Como responsable, debe ACEPTAR o RECHAZAR esta solicitud.  â•‘
â•‘                                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â•‘
â•‘  â”‚ âœ… APROBAR       â”‚        â”‚ âŒ RECHAZAR      â”‚          â•‘
â•‘  â”‚   SOLICITUD      â”‚        â”‚    SOLICITUD     â”‚          â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â•‘
â•‘                                                              â•‘
â•‘  âš ï¸ InformaciÃ³n Importante:                                 â•‘
â•‘  â€¢ Este enlace es Ãºnico y de un solo uso                    â•‘
â•‘  â€¢ Expira en 48 horas                                       â•‘
â•‘  â€¢ No comparta este enlace con terceros                     â•‘
â•‘                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸš€ CÃ³mo Usar

### Paso 1: Acceder al Formulario

Hay dos formas de acceder:

#### OpciÃ³n A: Desde el menÃº de GLPI
```
1. Login en GLPI como L1 o tÃ©cnico
2. Ir a: Asistencia â†’ Solicitud Correo Docente
3. Clic en "Nueva Solicitud"
```

#### OpciÃ³n B: URL directa
```
https://tu-glpi.com/plugins/emailapproval/front/request.form.php
```

### Paso 2: Completar el Formulario

#### Datos del Docente (obligatorios)
```
Nombre completo:        Juan PÃ©rez GarcÃ­a
Nro. de Legajo:         12345
Email deseado:          juan.perez@institucion.edu.ar
```

#### Departamento/Ãrea (obligatorio)
```
Departamento:           Departamento de InformÃ¡tica
```

#### Responsable Aprobador (obligatorio)
```
Email del responsable:  director.informatica@institucion.edu.ar
```

#### Observaciones (opcional)
```
Nuevo docente contratado para el ciclo lectivo 2026.
Requiere acceso urgente para gestiÃ³n de materias.
```

### Paso 3: Enviar Solicitud

1. Revisar todos los datos
2. Clic en "ğŸ“¤ Enviar Solicitud"
3. El sistema:
   - Crea un ticket automÃ¡ticamente
   - Genera token seguro
   - EnvÃ­a email al responsable
   - Registra en auditorÃ­a

---

## ğŸ”„ Flujo Completo

```
L1 llena formulario
       â†“
Sistema crea ticket en GLPI
       â†“
Genera token seguro (256 bits)
       â†“
EnvÃ­a email bonito al responsable
       â†“
Responsable recibe email con botones
       â†“
Clic en APROBAR o RECHAZAR
       â†“
Sistema valida token
       â†“
Actualiza ticket automÃ¡ticamente
       â†“
Registra decisiÃ³n en auditorÃ­a
       â†“
FIN (L1 ve resultado en el ticket)
```

---

## ğŸ“Š Ventajas del Formulario Manual

### âœ… Control Total
- L1 revisa datos antes de enviar
- Puede corregir errores de tipeo
- Puede aÃ±adir contexto adicional

### âœ… Flexibilidad
- Email del responsable personalizable por solicitud
- Ãštil cuando hay mÃºltiples responsables
- Ãštil para casos especiales

### âœ… Trazabilidad
- Ticket creado automÃ¡ticamente
- Registro de quiÃ©n creÃ³ la solicitud
- Fecha y hora exacta
- Datos completos del docente

### âœ… Profesionalismo
- Email con diseÃ±o institucional
- InformaciÃ³n clara y organizada
- Botones grandes y visibles
- Funciona en mÃ³viles

---

## ğŸ—„ï¸ Campos Almacenados en Base de Datos

La tabla `glpi_plugin_emailapproval_approvals` ahora incluye:

| Campo | DescripciÃ³n | Ejemplo |
|-------|-------------|---------|
| teacher_name | Nombre completo del docente | Juan PÃ©rez GarcÃ­a |
| teacher_legajo | NÃºmero de legajo | 12345 |
| teacher_email | Email solicitado | juan.perez@institucion.edu.ar |
| department_name | Departamento/Ãrea | Dpto. de InformÃ¡tica |

---

## ğŸ” Consultas SQL Ãštiles

### Ver solicitudes por departamento
```sql
SELECT 
   teacher_name,
   teacher_legajo,
   teacher_email,
   department_name,
   status,
   created_at
FROM glpi_plugin_emailapproval_approvals
WHERE department_name = 'Departamento de InformÃ¡tica'
ORDER BY created_at DESC;
```

### Buscar por legajo
```sql
SELECT * FROM glpi_plugin_emailapproval_approvals
WHERE teacher_legajo = '12345';
```

### EstadÃ­sticas por departamento
```sql
SELECT 
   department_name,
   COUNT(*) as total,
   SUM(CASE WHEN status='approved' THEN 1 ELSE 0 END) as aprobadas,
   SUM(CASE WHEN status='rejected' THEN 1 ELSE 0 END) as rechazadas,
   SUM(CASE WHEN status='pending' THEN 1 ELSE 0 END) as pendientes
FROM glpi_plugin_emailapproval_approvals
GROUP BY department_name;
```

---

## ğŸ¨ PersonalizaciÃ³n del Email

### Cambiar colores
Editar en `inc/approval.class.php`, mÃ©todo `getEmailTemplate()`:

```php
// Header gradient
background: linear-gradient(135deg, #TU_COLOR_1 0%, #TU_COLOR_2 100%);

// BotÃ³n aprobar
background: linear-gradient(135deg, #28a745 0%, #20c997 100%);

// BotÃ³n rechazar
background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
```

### AÃ±adir logo institucional
```php
<tr>
   <td style="text-align: center; padding: 20px;">
      <img src="https://tu-institucion.edu.ar/logo.png" 
           alt="Logo" width="150" style="max-width: 100%;">
   </td>
</tr>
```

---

## âœ… ActualizaciÃ³n desde VersiÃ³n Anterior

Si ya tenÃ­as el plugin instalado:

### OpciÃ³n A: Reinstalar
```
1. ConfiguraciÃ³n â†’ Plugins
2. Email Approval â†’ Desactivar â†’ Desinstalar
3. Instalar â†’ Activar
```

### OpciÃ³n B: Solo actualizar BD
```sql
-- Ejecutar script de actualizaciÃ³n
source install/mysql/update_1.1.sql;
```

---

## ğŸ› Troubleshooting

### El formulario no aparece en el menÃº
- Verificar permisos: Usuario debe tener permiso "Crear ticket"
- Verificar plugin estÃ¡ activado
- Limpiar cachÃ© del navegador

### Email no se ve bonito
- Cliente de email no soporta HTML (raro)
- Se enviarÃ¡ versiÃ³n texto plano automÃ¡ticamente
- Probar con Gmail, Outlook, Apple Mail

### Error al enviar formulario
- Verificar todos los campos obligatorios
- Verificar formato de emails (@ y dominio)
- Revisar logs: `/var/www/html/glpi/files/_log/php-errors.log`

---

## ğŸ“š DocumentaciÃ³n Relacionada

- **README.md** - DocumentaciÃ³n general del plugin
- **INSTALL.md** - InstalaciÃ³n y configuraciÃ³n
- **EXAMPLES.md** - Casos de prueba
- **WORKFLOW.md** - Flujo detallado del proceso

---

## ğŸ“ Mejores PrÃ¡cticas

### Para L1:
1. âœ… Verificar datos del docente antes de enviar
2. âœ… Usar el email corporativo del docente
3. âœ… Seleccionar el responsable correcto del departamento
4. âœ… AÃ±adir observaciones si hay casos especiales
5. âœ… Verificar en el ticket que el email se enviÃ³

### Para Responsables:
1. âœ… Revisar datos del docente cuidadosamente
2. âœ… Aprobar solo si la solicitud es vÃ¡lida
3. âœ… Responder dentro de las 48 horas
4. âœ… No compartir el enlace de aprobaciÃ³n

---

## ğŸš€ Roadmap Futuro

### v1.2 (PrÃ³ximamente)
- [ ] ValidaciÃ³n automÃ¡tica contra base de legajos
- [ ] Autocompletado de datos desde LDAP
- [ ] Adjuntar documentaciÃ³n (DNI, contrato)
- [ ] NotificaciÃ³n al docente cuando se aprueba
- [ ] Templates predefinidos por departamento

### v2.0 (Futuro)
- [ ] AprobaciÃ³n multinivel (jefe â†’ director)
- [ ] Dashboard de solicitudes pendientes
- [ ] Reportes estadÃ­sticos visuales
- [ ] IntegraciÃ³n con Active Directory
- [ ] App mÃ³vil para aprobadores

---

## ğŸ“ Soporte

Â¿Problemas o sugerencias?
- ğŸ“§ Email: soporte@institucion.edu.ar
- ğŸ› GitHub Issues
- ğŸ“š Wiki del proyecto

---

**VersiÃ³n:** 1.1.0  
**Fecha:** 12 de febrero de 2026  
**Autor:** Senior PHP Developer
